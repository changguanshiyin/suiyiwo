(function(){var u=document.compatMode!=="CSS1Compat",q=function(a,b){return/^http:\/\/[a-zA-Z0-9]\.share\.photo\.xuite\.net/i.test(a)?a.replace(/\_([a-z])\.jpg/i,"_"+b+".jpg"):a};window.BlogPlugins=window.BlogPlugins||{};BlogPlugins.LeadingArea=function(a,b){var c=$.extend({interval:5E3,data_source:"html",json_data:null,api_instance:null},b);this.data_source=c.data_source;this.json_data=c.json_data;this.prefetch_buffer=12;this.interval=c.interval;this.$target=$(a);this.api=c.api_instance||new XUI.API(document.body,
{key:"9fbd90f2022c3047a7ccc18ad06e8b10",secret:"8817775100"});this.$list=this.$status=this.$now_play=this.$end_pointer=this.$start_pointer=this.$player=this.owner=this.format=this.type=this.title=this.color=this.tick_timer=this.areaWidth=this.areaHeight=this.prev_tick_time=this._flipElement=this.result_item_tpl=null;this._verify_error=this._prefetching=this._all_prefetched=!1;this._savedData=null;this._fetch_format_list=[]};var o,v=function(a,b){var c=this,e=function(){var d=new Image;d.onload=function(){var a=
this.naturalWidth||this.width,d=this.naturalHeight||this.height,e=c.areaWidth,f=c.areaHeight;switch(c.format){case "photo":e*=0.8;f*=0.8;break;case "focuslist":e-=180;break;case "flip":case "fade":break;default:e=f=0}if(e!=0&&f!=0)a/d>e/f?(this.width=e,this.height=d/a*e):(this.height=f,this.width=a/d*f);c.setStatus("\u8b80\u53d6\u5716\u7247\u4e2d\uff0c\u5269"+o--+"\u5f35");b.resolve()};d.onerror=function(){c.setStatus("\u8b80\u53d6\u5716\u7247\u4e2d\uff0c\u5269"+o--+"\u5f35");b.resolve()};d.src=a.data("orig-pic");
$(d).appendTo(a.find(".leading-area-thumb-outer")).addClass("leading-area-orig-pic")};switch(c.format){case "photo":case "fade":case "flip":case "focuslist":e();break;default:b.resolve()}};BlogPlugins.LeadingArea.prototype={constructor:BlogPlugins.LeadingArea,_initLayout:function(){var a=this;a.result_item_tpl=$('<li id="type-item-id" class="leading-area-item leading-area-item-waiting"><a href="#leading-area-item-href" target="_blank" class="leading-area-item-link"><div class="leading-area-thumb-outer"><img class="leading-area-item-thumb" src="http://photo.xuite.net/images/spinner.gif" /></div><div class="leading-area-item-title">\u6211\u662f\u4e00\u500b\u5c0f\u80d6\u5b50</div><div class="leading-area-item-description"><div class="leading-area-bottomtext">Description</div></div></a></li>');
if(a.data_source=="json")if(a._verifyJSON())a._jsonToHTML();else return;if(a._verifyHTML()){a._savedData=a._htmlToJSON();if(u&&document.all&&!window.atob)a.format="list";if(a.format=="flip"&&!window.WebKitAnimationEvent&&!window.AnimationEvent)a.format="focuslist";a._prefetch(-1*a.prefetch_buffer).then(function(){return a._prefetch(a.prefetch_buffer)}).then(function(){a.setStatus("\u6b63\u5728\u521d\u59cb\u5316\u7126\u9ede\u7248\u4f4d\u6a23\u5f0f");return a._prefetchByFormat()}).then(function(){a._pause(!1);
a._tick(1)})}},_prefetchByFormat:function(){var a=this,b=$.Deferred(),c=a.$list.children();o=c.length;var e=[];c.map(function(){var b=$.Deferred(),c=$(this);c.is(".leading-area-item-waiting,.leading-area-item-more")||(v.apply(a,[c,b,o]),e.push(b.promise()))});$.when.apply($,e).then(function(){a.setStatus("");a.$target.removeClass("leading-area-init").addClass("leading-area-format-"+a.format).addClass("leading-area-color-"+a.color);document.all&&window.atob&&a.$target.addClass("leading-area-ie10");
b.resolve()});return b.promise()},_prefetchByFormatCont:function(){var a=this,b=$.Deferred(),c=a._fetch_format_list;a._fetch_format_list=[];if(a.prev_tick_time){if(c.length){o=c.length;var e=[];$.map(c,function(b){var c=$.Deferred(),b=$(document.getElementById(b));b.is(".leading-area-item-waiting,.leading-area-item-more")||(v.apply(a,[b,c,o]),e.push(c.promise()))});$.when.apply($,e).then(function(){a.setStatus("");b.resolve()})}}else b.resolve();return b.promise()},_pause:function(a){var b=this;if(a)clearTimeout(b.tick_timer),
b.tick_timer=null;else if(!b.tick_timer)b.tick_timer=setTimeout(function e(){(new Date).getTime()-b.prev_tick_time>=b.interval*0.8&&b._tick(1);b.tick_timer=setTimeout(e,b.interval)},b.interval)},_initEvent:function(){var a=this;a.$list.mouseover(function(){a._pause(!0)}).mouseout(function(){a._pause(!1)});a.$target.find(".leading-area-next").click(function(){a._tick(1)});a.$target.find(".leading-area-prev").click(function(){a._tick(-1)});a.$list.on("click",".leading-area-item,.leading-area-item-flip",
function(b){var c=$(this);if(!b.ctrlKey&&(b.preventDefault(),a.format=="focuslist"?c.is(".leading-area-now-next1")?a._tick(1):c.is(".leading-area-now-next2")?a._tick(2):c.is(".leading-area-now-prev1")?a._tick(-1):c.is(".leading-area-now-prev2")&&a._tick(-2):a.format=="list"&&a._tick(c.prevAll().length-a.$now_play.prevAll().length),location.pathname.indexOf("/_my2/leading_area.phtml")!==0))u?window.open(c.find(".leading-area-item-link").attr("href")):c.is(".leading-area-article")?location.href=c.find(".leading-area-item-link").attr("href"):
(a.$player||(a.renderPlayer(),a.$player.setCurrent()),a.$player.open(),setTimeout(function(){a.$player.refreshContainer();a._pause(!a.$player.pause_button.is(":visible"))},100))})},_is_valid:function(a,b){if(!this._verify_error&&!a)this._verify_error=!0,alert("BlogPlugin.LeadingArea: "+b)},_verifyHTML:function(){var a=this._is_valid,b=this.$list=this.$target.find(".leading-area-list"),c=this.$status=this.$target.find(".leading-area-tips"),e=this.$target;a(b.length===1,"(html) \u627e\u4e0d\u5230\u7126\u9ede\u7248\u4f4d\u7684\u7d20\u6750\u5217\u8868");
a(c.length===1,"(html) \u627e\u4e0d\u5230\u7126\u9ede\u7248\u4f4d\u7684\u63d0\u793a\u5143\u4ef6");a($.inArray(e.data("format"),["fade","photo","flip","list","focuslist"])!=-1,"(html) \u7126\u9ede\u7248\u4f4d\u7684\u683c\u5f0f\u4e0d\u6b63\u78ba");a($.inArray(e.data("color"),["white","red","yellow","green","blue","purple","black"])!=-1,"(html) \u7126\u9ede\u7248\u4f4d\u7684\u4e3b\u8272\u7cfb\u4e0d\u6b63\u78ba");a(e.data("owner")!="","(html) \u7126\u9ede\u7248\u4f4d\u64c1\u6709\u8005\u5224\u8b80\u6709\u8aa4");
if(!this._verify_error)a($.inArray(b.data("type"),["album","article","video"])!=-1,"(html) \u7126\u9ede\u7248\u4f4d\u7684\u985e\u5225\u4e0d\u6b63\u78ba"),a(b.children(".leading-area-item").length>0,"(html) \u7126\u9ede\u7248\u4f4d\u7684\u7d20\u6750\u6e05\u55ae\u4e0d\u5f97\u70ba\u7a7a"),this.format=e.data("format"),this.title=e.data("title"),this.color=e.data("color"),this.owner=e.data("owner"),this.type=b.data("type"),this.areaWidth=this.$target.width(),this.areaHeight=this.$target.height();return!this._verify_error},
_verifyJSON:function(){var a=this._is_valid,b=this.json_data;a(b,"\u7126\u9ede\u7248\u4f4d\u5fc5\u9700\u6307\u5b9a json_data");a(b.owner!="","\u7126\u9ede\u7248\u4f4d\u64c1\u6709\u8005\u5224\u8b80\u6709\u8aa4");a($.inArray(b.type,["album","article","video"])!=-1,"\u7126\u9ede\u7248\u4f4d\u7684\u985e\u5225\u4e0d\u6b63\u78ba");a($.inArray(b.format,["fade","photo","flip","list","focuslist"])!=-1,"\u7126\u9ede\u7248\u4f4d\u7684\u683c\u5f0f\u4e0d\u6b63\u78ba");a($.inArray(b.color,["white","red","yellow",
"green","blue","purple","black"])!=-1,"\u7126\u9ede\u7248\u4f4d\u7684\u4e3b\u8272\u7cfb\u4e0d\u6b63\u78ba");a($.isArray(b.list),"\u7126\u9ede\u7248\u4f4d\u7684 json_data.list \u5fc5\u9700\u662f\u9663\u5217");if(!this._verify_error)for(var c=0,e=b.list.length;c<e;++c){var d=b.list[c];a(d.title!==void 0&&d.thumb!==void 0&&d.href!==void 0&&d.type!==void 0&&d.waiting!==void 0,"\u7b2c "+c+" \u500b\u7126\u9ede\u7248\u4f4d\u7d20\u6750(json_data.list["+c+"])\u7684\u683c\u5f0f\u5fc5\u9700\u662f {title, thumb, href, type, waiting} \u7684 json \u683c\u5f0f")}return!this._verify_error},
_newItemDOM:function(a,b,c,e,d,g,j){var h=this.result_item_tpl.clone();h.attr("id",a);h.addClass("leading-area-"+b);h.find(".leading-area-item-link").attr("href",c);h.find(".leading-area-item-thumb").attr("src",e);h.find(".leading-area-item-title").text(d);$.trim(g)?h.find(".leading-area-bottomtext").text(g):h.find(".leading-area-item-description").remove();j&&h.removeClass("leading-area-item-waiting");return h},_jsonToHTML:function(){var a=this.json_data;this.$target.html('<div class="leading-area-tips">\u7126\u9ede\u7248\u4f4d\u521d\u59cb\u5316\u4e2d\uff0c\u8acb\u7a0d\u5019...</div><button class="leading-area-prev" title="\u5f80\u524d\u64ad\u653e">\u5f80\u524d\u64ad\u653e</button><button class="leading-area-next" title="\u5f80\u5f8c\u64ad\u653e">\u5f80\u5f8c\u64ad\u653e</button><ul class="leading-area-list" data-type="type"></ul>');
this.$target.addClass("leading-area").addClass("leading-area-init");this.$target.data({owner:a.owner,title:a.title,format:a.format,color:a.color}).attr({"data-owner":a.owner,"data-title":a.title,"data-format":a.format,"data-color":a.color});this.$target.find(".leading-area-list").data("type",a.type).attr("data-type",a.type);for(var b=document.createDocumentFragment(),c=0,e=a.list.length;c<e;++c){var d=a.list[c];if(d.type=="video"){var g=d.description.replace(/<img /g,"<noimg "),g=$("<span>").html(g.replace(/<script/gi,
"<\!-- noscript").replace(/<\/script[^>]*>/gi,"/noscript --\>")),g=g.text().substr(0,300),g=this._newItemDOM(d.id,a.type,d.href,d.thumb,d.title,g,!0),d=d.thumb.replace(/\/n_([^\/]+)$/,"/$1");g.data("orig-pic",d).attr("data-orig-pic",d);b.appendChild(g[0])}else b.appendChild(this._newItemDOM(d.id,a.type,d.href,d.thumb,d.title,"",!1)[0])}this.$target.find(".leading-area-list").append(b)},_htmlToJSON:function(){var a={owner:this.$target.data("owner"),title:this.$target.data("title"),format:this.$target.data("format"),
color:this.$target.data("color"),type:this.$list.data("type"),list:[]};this.$list.children(".leading-area-item").map(function(){var b=$(this),c={type:this.id.match(/^[^\-]+/)[0],id:this.id,title:b.find(".leading-area-item-title").text(),description:b.find(".leading-area-bottomtext").text(),thumb:b.find(".leading-area-item-thumb").attr("src"),thumb_orig:b.data("orig-pic"),href:b.find(".leading-area-item-link").attr("href"),waiting:!1};if(b.is(".leading-area-item-more"))c.more={"for":b.data("for"),
start:b.data("start"),end:b.data("end")},c.waiting=!0;else if(b.is(".leading-area-item-waiting"))c.waiting=!0;a.list.push(c)});return a},_tick:function(a){var b=this,c=b.$now_play;if(!b.$list.is(".leading-area-flip-prev,.leading-area-flip-next")){for(var e=a;e!=0;e+=a>0?-1:1){if(b.$now_play)if(b.$now_play.removeClass("leading-area-now-play"),a>0)b.$now_play=b.$now_play.next("li.leading-area-item");else{if(a<0)b.$now_play=b.$now_play.prev("li.leading-area-item")}else b.$now_play=$("");if(b.$now_play.length==
0)if(a>0)b.$now_play=b.$list.children("li.leading-area-item:first");else if(a<0)b.$now_play=b.$list.children("li.leading-area-item:last");if(b.$now_play.is(".leading-area-item-waiting,.leading-area-item-more")){(b.$now_play=c)&&c.length==1&&b.$now_play.addClass("leading-area-now-play");b._prefetch(b.prefetch_buffer*(a<0?-1:1)).then(function(){return b._prefetchByFormatCont()}).then(function(){b._tick(e)});return}}c=b.$now_play;$(".leading-area-now-next1").removeClass("leading-area-now-next1");$(".leading-area-now-next2").removeClass("leading-area-now-next2");
$(".leading-area-now-next3").removeClass("leading-area-now-next3");$(".leading-area-now-prev1").removeClass("leading-area-now-prev1");$(".leading-area-now-prev2").removeClass("leading-area-now-prev2");$(".leading-area-now-prev3").removeClass("leading-area-now-prev3");c.addClass("leading-area-now-play");for(var d=$next_relate_node=c,e=1;e<=3;++e){$next_relate_node=$next_relate_node.next("li.leading-area-item");$next_relate_node.length==0&&($next_relate_node=b.$list.children("li.leading-area-item:first"));
if(!$next_relate_node.is(".leading-area-now-play")&&$next_relate_node[0]!=d[0])$next_relate_node.addClass("leading-area-now-next"+e);else break;d=d.prev("li.leading-area-item");d.length==0&&(d=b.$list.children("li.leading-area-item:last"));if(!d.is(".leading-area-now-play")&&d[0]!=$next_relate_node[0])d.addClass("leading-area-now-prev"+e);else break}if(b.format=="flip"&&(!b.$player||!b.$player.is_show)){c=function(a){b.$list.removeClass("leading-area-flip-prev").removeClass("leading-area-flip-next");
a&&(b._flipElement.left.html(""),b._flipElement.right.html(""))};if(!b._flipElement)b._flipElement={left:$('<li class="leading-area-item-flip leading-area-item-flip-left">').bind("animationend",c).bind("webkitAnimationEnd",c).appendTo(b.$list),right:$('<li class="leading-area-item-flip leading-area-item-flip-right">').appendTo(b.$list)};a<0?(b._flipElement.left.html($(".leading-area-now-next1").html()),b._flipElement.right.html($(".leading-area-now-play").html()),c(!1),b.$list.addClass("leading-area-flip-prev")):
a>0&&(b._flipElement.left.html($(".leading-area-now-play").html()),b._flipElement.right.html($(".leading-area-now-prev1").html()),c(!1),b.$list.addClass("leading-area-flip-next"))}else if(b.format=="list"&&!c.is(":visible"))if(b.$list.children(".leading-area-item").attr("style",null),a>0)for(e=0;e<8&&c.length==1;++e,c=c.next(".leading-area-item"))c.css("display","inline-block");else if(a<0)for(e=0;e<8&&c.length==1;++e,c=c.prev(".leading-area-item"))c.css("display","inline-block");b._all_prefetched?
b.$player&&b.$player.setCurrent():b._checkPrefetch(a)?b._prefetch(b.prefetch_buffer*(a<0?-1:1)).then(function(){b.$player&&b.$player.setCurrent();return b._prefetchByFormatCont()}):b.$player&&b.$player.setCurrent();b.prev_tick_time=(new Date).getTime()}},_checkPrefetch:function(a){var b=this.$now_play;if(a>0){for(var a=0,b=b.next(".leading-area-item"),c=parseInt(this.prefetch_buffer/2,10);b.length>0&&a<c;++a,b=b.next(".leading-area-item"))if(b[0]===this.$start_pointer[0])return!0;return!1}else if(a<
0){a=0;b=b.prev(".leading-area-item");for(c=parseInt(this.prefetch_buffer/2,10);b.length>0&&a<c;++a,b=b.prev(".leading-area-item"))if(b[0]===this.$end_pointer[0])return!0;return!1}},_prefetch:function(a,b){var c,e;if(a===0)alert("\u7126\u9ede\u7248\u4f4d\u9810\u8b80\u65b9\u5411\u932f\u8aa4");else{a>0?c="$start_pointer":a<0&&(c="$end_pointer");var d=this;if(!b&&d._prefetching)return d._prefetching;var g=$.Deferred();if(!d._prefetching)d._prefetching=g.promise();if(d._all_prefetched||d.$start_pointer&&
d.$end_pointer&&d.$start_pointer[0]===d.$end_pointer[0]){if(!b)d._prefetching=!1;d._all_prefetched=!0;g.resolve(e);return g.promise()}if(this[c]===null){if(a<0?e=this[c]=this.$list.children(".leading-area-item").last():a>0&&(e=this[c]=this.$list.children(".leading-area-item").first()),e.length==0){e=this.$start_pointer=this.end_pointer=this.$list.children(".leading-area-item:first");if(!b)d._prefetching=!1;this._all_prefetched=!0;g.resolve(e);return g.promise()}}else if(a>0&&this[c].next(".leading-area-item").length==
0||a<0&&this[c].prev(".leading-area-item").length==0){if(!b)d._prefetching=!1;this._all_prefetched=!0;g.resolve(e);return g.promise()}else a<0?e=this[c]=this[c].prev(".leading-area-item"):a>0&&(e=this[c]=this[c].next(".leading-area-item"));if(e.is(".leading-area-item-waiting")){var j=e.attr("id").split("-item-");switch(j[0]){case "album":this.setStatus("\u6b63\u5728\u8b80\u53d6\u76f8\u7c3f\u8cc7\u8a0a\u2026");this.api.call("xuite.photo.public.getPhotos",{start:0,limit:1,user_id:this.owner,album_id:j[1]},
function(f){d.setStatus("");if(f.ok){var f=parseInt(f.rsp.total,10),i;a<0?(i=f+a,f=a*-1):(i=0,f=a);d.setStatus("\u6b63\u5728\u8b80\u53d6\u76f8\u7c3f\u8cc7\u8a0a\u2026");d.api.call("xuite.photo.public.getPhotos",{start:i,limit:f,user_id:d.owner,album_id:j[1]},function(f){d.setStatus("");if(f.ok){for(var h=parseInt(f.rsp.total,10),n=f.rsp.photos.length,m=document.createDocumentFragment(),l=0;l<n;++l){var r=f.rsp.photos[l],k="photo-item-"+j[1]+"-"+r.position,o=d._newItemDOM(k,"photo",["http://photo.xuite.net/",
d.owner,"/",j[1],"/",r.position,".jpg"].join(""),r.thumb,r.image_name,r.image_description,!0),r=r.thumb.replace(/\_.\.jpg([^\/]*)$/i,"_m.jpg$1");o.data({"orig-pic":r}).attr("data-orig-pic",r);d.prev_tick_time&&d._fetch_format_list.push(k);m.appendChild(o[0])}a<0?(d[c]=$(m.firstChild),d[c].length==0&&(d[c]=null),h>n&&(f=$(['<li id="photo-item-',j[1],'-more" class="leading-area-item leading-area-item-more" data-for="',j[1],'" data-start="0" data-end="',i-1,'"></li>'].join("")),m.insertBefore(f[0],m.firstChild)),
e.before(m),e.remove(),e=d[c],a+=n):a>0&&(d[c]=$(m.lastChild),d[c].length==0&&(d[c]=null),h>n&&(f=$(['<li id="photo-item-',j[1],'-more" class="leading-area-item leading-area-item-more" data-for="',j[1],'" data-start="',n,'" data-end="',h-1,'"></li>'].join("")),m.appendChild(f[0])),e.after(m),e.remove(),e=d[c],a-=n,d[c].length==0&&(d[c]=null));if(a!=0)d._prefetch(a,!0).then(function(a){if(!b)d._prefetching=!1;g.resolve(a)});else{if(!b)d._prefetching=!1;g.resolve(e)}}else alert("\u53d6\u5f97\u76f8\u7c3f\u8cc7\u8a0a\u904e\u7a0b\u767c\u751f\u932f\u8aa4\uff1a"+
f.msg[1])})}else alert("\u53d6\u5f97\u76f8\u7c3f\u8cc7\u8a0a\u904e\u7a0b\u767c\u751f\u932f\u8aa4\uff1a"+f.msg[1])});break;case "article":this.setStatus("\u6b63\u5728\u8b80\u53d6\u6587\u7ae0\u8cc7\u8a0a\u2026("+(a<0?"\u5f80\u524d\u8b80 "+a*-1:"\u5f80\u5f8c\u8b80 "+a)+" \u7bc7)"),this.api.call("xuite.blog.public.getArticle",{user_id:this.owner,blog_id:j[1].split("-")[0],article_id:j[1].split("-")[1]},function(f){var l;d.setStatus("");if(f.ok){var i=document.createDocumentFragment(),f=f.rsp,h=f.content.match(/<\!\-\-XUI:(img\.|firstImage=<img )src=\"([^\"]+)"/),
h=(l=(h=h&&h[2].replace(/\_.\.jpg([^\/]*)$/i,"_m.jpg$1"))||f.content.match(/<img[^>]*[\s]src[\s]*=[\s]*[\'\"]([^\'\"]+.(jpg|png)[^\'\"]*)[\'\"]/),h=l)||f.thumb;typeof h!="string"&&(h=h[1]);var k=f.content.replace(/<img /g,"<noimg "),k=$("<span>").html(k.replace(/<script/gi,"<\!-- noscript").replace(/<\/script[^>]*>/gi,"/noscript --\>")),k=k.text().substr(0,300),n="article-item-"+j[1];i.appendChild(d._newItemDOM(n,"article",f.url,f.thumb,f.title,k,!0)[0]);d[c]=$(i.firstChild);e.after(i);e.remove();
e=d[c];e.data({"orig-pic":h}).attr("data-orig-pic",h);d.prev_tick_time&&d._fetch_format_list.push(n);a<0?a++:a>0&&a--;if(a!=0)d._prefetch(a,!0).then(function(a){if(!b)d._prefetching=!1;g.resolve(a)});else{if(!b)d._prefetching=!1;g.resolve(e)}}else alert("\u53d6\u5f97\u6587\u7ae0\u8cc7\u8a0a\u904e\u7a0b\u767c\u751f\u932f\u8aa4\uff1a"+f.msg[1])})}}else if(e.is(".leading-area-item-more")){var h=e.data("for"),f=parseInt(e.data("start"),10),i=parseInt(e.data("end"),10),k=i-f+1<this.prefetch_buffer?i-f+
1:this.prefetch_buffer;a<0&&-1*a<k?k=-1*a:a>0&&a<k&&(k=a);this.setStatus("\u6b63\u5728\u8ffd\u52a0\u76f8\u7247\u8cc7\u8a0a\u2026");this.api.call("xuite.photo.public.getPhotos",{start:a>0?f:i-k+1,limit:k,user_id:this.owner,album_id:h},function(k){d.setStatus("");if(k.ok){for(var j=document.createDocumentFragment(),p=k.rsp.photos.length,o=0;o<p;++o){var n=k.rsp.photos[o],m="photo-item-"+h+"-"+n.position,l=d._newItemDOM(m,"photo",["http://photo.xuite.net/",d.owner,"/",h,"/",n.position,".jpg"].join(""),
n.thumb,n.image_name,n.image_description,!0),n=n.thumb.replace(/\_.\.jpg([^\/]*)$/i,"_m.jpg$1");l.data({"orig-pic":n}).attr("data-orig-pic",n);d.prev_tick_time&&d._fetch_format_list.push(m);j.appendChild(l[0])}a<0?(d[c]=$(j.firstChild),e.after(j),i-p>=f?e.data("end",i-p).attr("data-end",i-p):e.remove(),e=d[c],a+=p):a>0&&(d[c]=$(j.lastChild),e.before(j),f+p<=i?e.data("start",f+p).attr("data-start",f+p):e.remove(),e=d[c],a-=p);if(a!=0)d._prefetch(a,!0).then(function(a){if(!b)d._prefetching=!1;g.resolve(a)});
else{if(!b)d._prefetching=!1;g.resolve(e)}}else alert("\u8ffd\u52a0\u76f8\u7247\u8cc7\u8a0a\u904e\u7a0b\u767c\u751f\u932f\u8aa4\uff1a"+k.msg[1])})}else if(a>0?a--:a<0&&a++,a!=0)this._prefetch(a,!0).then(function(a){if(!b)d._prefetching=!1;g.resolve(a)});else{if(!b)d._prefetching=!1;g.resolve(e)}return g.promise()}},setStatus:function(a){a?this.$status.html(a).animate({opacity:1},{queue:!1}):this.$status.animate({opacity:0},{queue:!1})},destroy:function(){this.$list.unbind("mouseover").unbind("mouseout");
this.$target.children().remove();this.$target.removeClass("leading-area-ie10").removeClass("leading-area-format-"+this.format).removeClass("leading-area-color-"+this.color);this.$target.attr({"data-owner":null,"data-title":null,"data-format":null,"data-color":null});clearTimeout(this.tick_timer);return this.$target},renderPlayer:function(){var a=this,b=$('<div id="leading-slide-wrap"><div id="leading-slide-wrap-inner"><div id="leading-slide-exposure" class="leading-slide-exposureTarget leading-slide-exposureLoaded"><button class="leading-slide-icon" id="leading-slide-closePlayer">Close Player</button><button class="leading-slide-icon" id="leading-slide-scrn_left">Prev</button><button class="leading-slide-icon" id="leading-slide-scrn_right">Next</button><div class="leading-slide-exposureWrapper"><img class="leading-slide-exposureImage leading-slide-exposureCurrentImage" src="http://photo.xuite.net/images/spinner.gif"></div></div><div id="leading-slide-setting"><div class="leading-slide-setting-inner"><button class="leading-slide-expand-caption leading-slide-icon">Prev</button><div class="leading-slide-photo-caption"><div class="leading-slide-photo-title">[title]</div><a id="leading-slide-pictureLink" target="_blank" href="#">&gt;&gt;\u524d\u5f80\u5716\u7247\u9023\u7d50</a><div class="leading-slide-photo-description">[description]</div></div><div class="leading-slide-setting-item"><span id="leading-slide-slideshow" class="leading-slide-exposureSlideshowControls"><button class="leading-slide-exposurePlaySlideshow leading-slide-icon">Play</button><button class="leading-slide-exposurePauseSlideshow leading-slide-icon">Pause</button></span><button class="leading-slide-timer5 leading-slide-icon" id="leading-slide-timerswitch">\u8b8a\u66f4\u64ad\u653e\u901f\u5ea6</button><span id="leading-slide-fullscrn" class="leading-slide-exposureFullscrnControls"><button class="leading-slide-exposureFullscrnControls leading-slide-icon">Full Screen</button></span><span id="leading-slide-backalbum" class="leading-slide-exposureBackalbumControls"><button class="leading-slide-exposureBackalbumControls leading-slide-icon">Back to Album</button></span></div></div></div><div id="leading-slide-toolbar"><div class="leading-slide-panel"><ul class="leading-slide-exposureThumbs"><li class="leading-slide-item leading-slide-first"><img class="leading-slide-img" src="http://photo.xuite.net/images/spinner.gif"><img class="leading-slide-preload" src="http://photo.xuite.net/images/spinner.gif"></li><li class="leading-slide-item"><img class="leading-slide-img" src="http://photo.xuite.net/images/spinner.gif"><img class="leading-slide-preload" src="http://photo.xuite.net/images/spinner.gif"></li><li class="leading-slide-item"><img class="leading-slide-img" src="http://photo.xuite.net/images/spinner.gif"><img class="leading-slide-preload" src="http://photo.xuite.net/images/spinner.gif"></li><li class="leading-slide-item leading-slide-active"><img class="leading-slide-img leading-slide-selected" src="http://photo.xuite.net/images/spinner.gif"><img class="leading-slide-preload" src="http://photo.xuite.net/images/spinner.gif"></li><li class="leading-slide-item"><img class="leading-slide-img" src="http://photo.xuite.net/images/spinner.gif"><img class="leading-slide-preload" src="http://photo.xuite.net/images/spinner.gif"></li><li class="leading-slide-item"><img class="leading-slide-img" src="http://photo.xuite.net/images/spinner.gif"><img class="leading-slide-preload" src="http://photo.xuite.net/images/spinner.gif"></li><li class="leading-slide-item leading-slide-last"><img class="leading-slide-img" src="http://photo.xuite.net/images/spinner.gif"><img class="leading-slide-preload" src="http://photo.xuite.net/images/spinner.gif"></li></ul></div></div><button class="leading-slide-closeMask leading-slide-icon"></button><div class="leading-slide-fullscrnMask"></div></div></div>').appendTo("body");
a.$player={dom:b,is_show:!1,is_fullscreen:!1,close_button:b.find("#leading-slide-closePlayer"),exit_fullscreen_button:b.find(".leading-slide-closeMask"),fullscreen_mask:b.find(".leading-slide-fullscrnMask"),fullscreen_button:b.find(".leading-slide-exposureFullscrnControls"),slide_setting:b.find("#leading-slide-setting"),slide_item:b.find(".leading-slide-setting-item"),slide_caption:b.find(".leading-slide-photo-caption"),play_button:b.find(".leading-slide-exposurePlaySlideshow"),pause_button:b.find(".leading-slide-exposurePauseSlideshow"),
main_image:b.find("#leading-slide-exposure"),modal_dom:$('<div id="leading-slide-wrap-modal" class="leading-slide-overlay-black"></div>)').insertBefore(b),thumb_container:b.find(".leading-slide-panel"),thumb_list:b.find(".leading-slide-exposureThumbs li .leading-slide-img"),title_dom:b.find(".leading-slide-photo-title"),description_dom:b.find(".leading-slide-photo-description"),link_dom:b.find("#leading-slide-pictureLink"),_resizeContainer:function(b,c){var g=a.$player;c&&g.main_image.css({width:450,
height:450});var j=!g.slide_setting.is(".leading-slide-collapsed"),h=g.is_fullscreen,f,i,k=$(window),o=k.width(),k=k.height(),t=g.main_image.outerWidth(),p=g.main_image.outerHeight(),q=h?0:j?226:26;g.slide_setting.outerHeight();var n=h?0:g.thumb_container.height(),m=h?24:6,l;if(b){f=b[0].naturalWidth;i=b[0].naturalHeight;if(!f||!i)i=new Image,i.src=b[0].src,f=i.width,i=i.height;if(f+m>t||i+m>p||c||h){l=o-q-m;var s=k-n-m;l=h?f/i>l/s?{w:l,h:l*i/f}:f/i<=l/s?{w:s*f/i,h:s}:void 0:f/i>l/s&&f>l?{w:l,h:l*
i/f}:f/i<=l/s&&i>s?{w:s*f/i,h:s}:{w:f,h:i};f=l.w;i=l.h;b.attr({width:l.w,height:l.h});l.w+m>t&&g.main_image.outerWidth(t=l.w+m);l.h+m>p&&g.main_image.outerHeight(p=l.h+m)}b.css({"margin-left":(t-m-f)/2,"margin-top":(p-m-i)/2})}f=q+t;q=p;h||(g.slide_setting.css({height:j?p-m:60,left:(o-f)/2+t-3-(j?0:200),top:(k-n-q)/2}),g.slide_caption.css({height:p-m-113}));g.main_image.css({left:(o-f)/2,top:(k-n-q)/2})},refreshContainer:function(){return this._resizeContainer(this.main_image.find(".leading-slide-exposureCurrentImage"),
!0)},setCurrent:function(){var b=[a.$list.find(".leading-area-now-prev3"),a.$list.find(".leading-area-now-prev2"),a.$list.find(".leading-area-now-prev1"),a.$list.find(".leading-area-now-play"),a.$list.find(".leading-area-now-next1"),a.$list.find(".leading-area-now-next2"),a.$list.find(".leading-area-now-next3")],c=this,g=c.dom,j,h=c.thumb_container.find('img.leading-slide-preload[src="'+(q(b[3].data("orig-pic"),"x")||q(b[3].find(".leading-area-item-thumb").attr("src"),"x"))+'"]');if(a.$now_play.is(".leading-area-video")){var f=
$('<iframe style="border:none" class="leading-slide-exposureCurrentImage" src="'+b[3].find(".leading-area-item-link").attr("href").replace("xuite.net/play/","xuite.net/embed/")+'">').prop({naturalWidth:800,naturalHeight:450}).attr({width:800,height:450});g.find(".leading-slide-exposureCurrentImage").replaceWith(f);c._resizeContainer(f,c.is_fullscreen)}else h.length===1&&(h.clone().insertAfter(h),g.find(".leading-slide-exposureCurrentImage").replaceWith(j=h.attr("class","leading-slide-exposureImage leading-slide-exposureCurrentImage").load(function(){c._resizeContainer(j,
c.is_fullscreen)})),c._resizeContainer(h,c.is_fullscreen));c.thumb_list.map(function(a){var c=$(this);b[a].length==0?c.parent().hide():(c.parent().show(),this.src=q(b[a].find(".leading-area-item-thumb").attr("src"),"q"),this.nextSibling.src=q(b[a].data("orig-pic"),"x")||q(b[a].find(".leading-area-item-thumb").attr("src"),"x"))});!a.$now_play.is(".leading-area-video")&&h.length!==1&&g.find(".leading-slide-exposureCurrentImage").replaceWith(j=$(".leading-slide-exposureThumbs li .leading-slide-preload:eq(3)").clone().load(function(){c._resizeContainer(j,
c.is_fullscreen)}).attr("class","leading-slide-exposureImage leading-slide-exposureCurrentImage"));c.title_dom.html(b[3].find(".leading-area-item-title").html());c.description_dom.html(b[3].find(".leading-area-item-description").html()||"");c.link_dom.attr("href",b[3].find(".leading-area-item-link").attr("href"));c.modal_dom.css("height",$(document).height());g=$(window);g.width();g.height();c.thumb_container.height()},close:function(){$("body").addClass("leading-slide-hide").removeClass("leading-slide-show");
this.is_show=!1;this.dom.find("iframe.leading-slide-exposureCurrentImage").attr("src","about:blank");a.interval=5E3;a._pause(!1)},open:function(){var a=this.dom;this.is_show=!0;$("body").addClass("leading-slide-show").removeClass("leading-slide-hide");a.css({top:$(window).scrollTop()})}};var c=a.$player;b.find("li,ul,#leading-slide-closePlayer").css("display","block");b.find("#leading-slide-scrn_left").click(function(){a._tick(-1)});b.find(".leading-slide-expand-caption").click(function(){c.slide_setting.is(".leading-slide-collapsed")?
(c.slide_setting.removeClass("leading-slide-collapsed").height(c.main_image.height()),c.main_image.animate({left:"-=100"}),c.slide_setting.animate({left:"+=100"},{queue:!1,duration:400,complete:function(){c.refreshContainer();c.slide_caption.fadeIn();c.slide_item.fadeIn()}})):(c.slide_item.fadeOut(),c.slide_caption.fadeOut({complete:function(){c.main_image.animate({left:"+=100"});c.slide_setting.animate({left:"-=100"},{queue:!1,duration:400,complete:function(){c.slide_caption.hide();c.slide_setting.addClass("leading-slide-collapsed").height(60);
c.refreshContainer()}})}}))});b.find("#leading-slide-scrn_right").click(function(){a._tick(1)});b.find("#leading-slide-timerswitch").click(function(){var b=$(this);$(this).hasClass("leading-slide-timer3")?(b.removeClass("leading-slide-timer3").addClass("leading-slide-timer5"),a.interval=5E3):$(this).hasClass("leading-slide-timer5")?(b.removeClass("leading-slide-timer5").addClass("leading-slide-timer1"),a.interval=1E3):(b.removeClass("leading-slide-timer1").addClass("leading-slide-timer3"),a.interval=
3E3)});b.find("#leading-slide-wrap-inner").click(function(a){a=$(a.target);(a.is("#leading-slide-wrap-inner")||a.is("#leading-slide-toolbar")||a.is(".leading-slide-exposureThumbs"))&&c.close()});c.play_button.click(function(){c.play_button.hide();c.pause_button.show();a._pause(!1)}).show();c.pause_button.click(function(){c.pause_button.hide();c.play_button.show();a._pause(!0)}).hide();c.main_image.click(function(){a._tick(1)});c.close_button.click(function(){c.close()});c.fullscreen_button.click(function(){c.is_fullscreen=
!0;c.fullscreen_mask.show();c.exit_fullscreen_button.show();c.slide_setting.hide();c.close_button.hide();c.main_image.addClass("leading-slide-fullscrnTarget").removeClass("leading-slide-exposureTarget");c._resizeContainer(c.main_image.find(".leading-slide-exposureCurrentImage"),!0)});c.exit_fullscreen_button.click(function(){c.is_fullscreen=!1;c.fullscreen_mask.hide();c.exit_fullscreen_button.hide();c.slide_setting.show();c.close_button.show();c.main_image.addClass("leading-slide-exposureTarget").removeClass("leading-slide-fullscrnTarget");
c._resizeContainer(c.main_image.find(".leading-slide-exposureCurrentImage"),!0)});c.thumb_container.find("li.leading-slide-item").map(function(b,c){$(c).click(function(b){return function(){a._tick(b-3)}}(b))});c._resizeContainer()},render:function(){window.leadingArea=this;this._initLayout();this._initEvent()}}})();
